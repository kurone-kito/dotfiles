#!/bin/sh
# vim: set ft=sh :

set -eu

brew cask upgrade
brew update
brew upgrade
brew cleanup -s

upgrade_node() {
  VER=$1
  LATEST=$(nodenv install -l | grep -e "^\s\+\(${VER}\.\d\+\.\d\+\)" | tail -n 1 | xargs)
  nodenv install -s "${LATEST}"
  nodenv global "${LATEST}"

  npm upgrade -g
  npm install -g npm@latest
  npm install -g exp@latest serverless@latest yarn@latest
  npm install -g --no-optional @aws-amplify/cli@latest
}

upgrade_node 8
upgrade_node 10
upgrade_node 12
